<!-- Page Header -->
<div class="page-header">
  <div>
    <h1 class="page-title">Flights</h1>
  </div>
</div>

<!-- Finance Cards -->
<div class="finance-cards" id="stats-cards">
  <div class="finance-card animation-delay-0">
    <div class="finance-card-content">
      <div class="finance-card-icon finance-card-icon--orange">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </div>
      <div class="finance-card-info" style="flex: 1; display: flex; flex-direction: column;">
        <h3 class="finance-card-title">Total Flights</h3>
        <div class="finance-card-value-row" style="display: flex; justify-content: space-between; align-items: flex-end;">
          <span class="finance-card-value" id="total-flights-value">0</span>
          <div id="flights-year-details" style="display: none; text-align: right; font-size: 0.7rem; color: hsl(210, 6%, 46%); line-height: 1.3;">
            <div>
              <span id="flights-this-year">0</span> this year
            </div>
            <div>
              <span id="flights-last-year">0</span> last year
            </div>
            <div id="flights-change" style="font-weight: 500; margin-top: 0.125rem;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="finance-card animation-delay-100">
    <div class="finance-card-content">
      <div class="finance-card-icon finance-card-icon--blue">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
          <line x1="8" y1="21" x2="16" y2="21"></line>
          <line x1="12" y1="17" x2="12" y2="21"></line>
        </svg>
      </div>
      <div class="finance-card-info">
        <h3 class="finance-card-title">Active Invoices</h3>
        <div class="finance-card-value-row">
          <span class="finance-card-value" id="active-invoices-value">0</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Flights Table -->
<div class="table-container">
  <div class="table-card">
    <div class="table-header">
      <div class="table-title">
        <h3>Flight Operations</h3>
        <span class="table-subtitle">All scheduled and completed flights</span>
      </div>
      <div class="table-actions">
        <a href="/flights/expenses" class="btn btn-primary" style="margin-right: 0.5rem;">
          <i class="bi bi-airplane"></i>
          Check flight expenses
        </a>
        <% if (user && user.role === 'superadmin') { %>
        <button class="btn btn-primary" id="addFlightBtn">
          <i class="bi bi-plus-lg"></i>
          Add Flight
        </button>
        <% } else { %>
        <button class="btn btn-secondary" disabled title="Only superadmin can add flights">
          <i class="bi bi-plus-lg"></i>
          Add Flight
        </button>
        <% } %>
      </div>
    </div>
    
    <div class="table-wrapper">
      <table class="flights-table">
        <thead>
          <tr>
            <th class="checkbox-col">
              <input type="checkbox" class="form-check-input" id="selectAll">
            </th>
            <th class="sortable" id="dateSortHeader">
              DATE
              <i class="bi bi-chevron-up sort-icon" id="dateSortIcon"></i>
            </th>
            <th class="sortable">
              FLIGHT NO
              <i class="bi bi-chevron-down sort-icon"></i>
            </th>
            <th class="sortable">
              ROUTE
              <i class="bi bi-chevron-down sort-icon"></i>
            </th>
            <th class="sortable">
              FLIGHT TIME
              <i class="bi bi-chevron-down sort-icon"></i>
            </th>
            <th class="sortable">
              BLOCK TIME
              <i class="bi bi-chevron-down sort-icon"></i>
            </th>
            <th>COMMENTS</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody id="flights-table-body">
          <!-- Data will be loaded via JavaScript -->
        </tbody>
      </table>
              </div>
              </div>
              </div>

<!-- Add Flight Modal -->
<div id="addFlightModal" class="modal-overlay" style="display: none;">
  <div class="modal-container">
    <div class="modal-header">
      <h3>Add New Flight</h3>
      <button class="modal-close" id="closeModalBtn">
        <i class="bi bi-x-lg"></i>
                </button>
              </div>
    
    <form id="addFlightForm" class="modal-form">
      <div style="flex: 1; min-height: 0;">
        <div class="form-group">
          <label for="flightDate">Date</label>
          <input type="date" id="flightDate" name="flt_date" required>
              </div>
        
        <div class="form-group">
          <label for="flightNumber">Flight Number</label>
          <input type="text" id="flightNumber" name="flt_number" placeholder="e.g., F9105" required>
              </div>
        
        <div class="form-group">
          <label for="departure">Departure</label>
          <input type="text" id="departure" name="flt_dep" placeholder="e.g., Abu Dhabi" required>
              </div>
        
        <div class="form-group">
          <label for="arrival">Arrival</label>
          <input type="text" id="arrival" name="flt_arr" placeholder="e.g., Dubai" required>
              </div>
        
        <div class="form-group">
          <label for="flightTime">Flight Time</label>
          <input type="text" id="flightTime" name="flt_time" placeholder="e.g., 0130 (01:30)" maxlength="4" pattern="[0-9]{4}" required>
          <small class="form-help">Enter 4 digits (e.g., 0130 for 01:30)</small>
              </div>
        
        <div class="form-group">
          <label for="blockTime">Block Time</label>
          <input type="text" id="blockTime" name="flt_block" placeholder="e.g., 0215 (02:15)" maxlength="4" pattern="[0-9]{4}" required>
          <small class="form-help">Enter 4 digits (e.g., 0215 for 02:15)</small>
              </div>
        
        <div class="form-group">
          <label for="flightComments">Comments</label>
          <textarea id="flightComments" name="flt_comments" rows="3" placeholder="Enter comments (optional)"></textarea>
        </div>
      </div>
      
      <div class="modal-actions">
        <button type="button" class="btn btn-cancel" id="cancelBtn">
          Cancel
                </button>
        <button type="submit" class="btn btn-save" id="saveFlightBtn">
          <span class="btn-text">Save</span>
          <span class="btn-spinner" style="display: none;">
            <i class="bi bi-arrow-clockwise"></i>
          </span>
                </button>
              </div>
    </form>
              </div>
              </div>

<script>
let flightsData = [];
let currentSortOrder = 'desc';

// Load statistics
async function loadStats() {
  try {
    const response = await fetch('/api/dashboard/stats', {
      credentials: 'include'
    });
    
    if (response.ok) {
      const stats = await response.json();
      
      // Update Total Flights
      const totalFlightsEl = document.getElementById('total-flights-value');
      if (totalFlightsEl) {
        totalFlightsEl.textContent = stats.flights_count || 0;
      }

      // Update year details
      const flightsThisYearEl = document.getElementById('flights-this-year');
      const flightsLastYearEl = document.getElementById('flights-last-year');
      const flightsChangeEl = document.getElementById('flights-change');
      const flightsYearDetailsEl = document.getElementById('flights-year-details');

      if (flightsThisYearEl && flightsLastYearEl && flightsChangeEl && flightsYearDetailsEl) {
        const thisYear = stats.flights_this_year || 0;
        const lastYear = stats.flights_last_year || 0;
        const changePercent = stats.flights_change_percent || 0;

        flightsThisYearEl.textContent = thisYear;
        flightsLastYearEl.textContent = lastYear;

        if (changePercent !== 0) {
          const isIncrease = changePercent > 0;
          const sign = isIncrease ? '+' : '';
          const color = isIncrease ? 'hsl(142, 76%, 36%)' : 'hsl(0, 84%, 60%)';
          flightsChangeEl.innerHTML = `<span style="color: ${color};">${sign}${changePercent.toFixed(1)}%</span> vs last year`;
        } else {
          flightsChangeEl.innerHTML = '<span style="color: hsl(210, 6%, 46%);">No change</span>';
        }

        // Показываем детали только если есть данные
        if (thisYear > 0 || lastYear > 0) {
          flightsYearDetailsEl.style.display = 'block';
        }
      }
      
      // Update Active Invoices
      const activeInvoicesEl = document.getElementById('active-invoices-value');
      if (activeInvoicesEl) {
        activeInvoicesEl.textContent = stats.invoices_pending || 0;
      }
    }
  } catch (error) {
    console.error('Error loading stats:', error);
  }
}

// Load flights data from API
async function loadFlights() {
  try {
    const response = await apiRequest('/api/flights');
    console.log('Flights API response status:', response.status);
    const flights = await response.json();
    console.log('Flights API response data:', flights);
    
    // Check if flights is an array
    if (!Array.isArray(flights)) {
      console.error('Flights data is not an array:', flights);
      throw new Error('Invalid flights data format');
    }
    
    flightsData = flights;
    renderFlights();
    
    // Update stats after loading flights
    await loadStats();
  } catch (error) {
    console.error('Error loading flights:', error);
    console.error('Error details:', {
      message: error.message,
      stack: error.stack,
      name: error.name
    });
    
    // Show error message
    const tbody = document.getElementById('flights-table-body');
    tbody.innerHTML = `
      <tr>
        <td colspan="7" style="text-align: center; padding: 2rem; color: #6b7280;">
          <i class="bi bi-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
          Failed to load flights. Please try again.
          <br><small style="color: #9ca3af; margin-top: 0.5rem; display: block;">Error: ${error.message}</small>
        </td>
      </tr>
    `;
  }
}

function renderFlights() {
  const tbody = document.getElementById('flights-table-body');

  if (!tbody) {
    return;
  }

  tbody.innerHTML = '';

  if (!Array.isArray(flightsData) || flightsData.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="8" style="text-align: center; padding: 2rem; color: #6b7280;">
          <i class="bi bi-info-circle" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
          No flights available.
        </td>
      </tr>
    `;
    return;
  }

  const sortedFlights = [...flightsData].sort((a, b) => {
    const dateA = new Date(a.flt_date).getTime();
    const dateB = new Date(b.flt_date).getTime();

    return currentSortOrder === 'asc' ? dateA - dateB : dateB - dateA;
  });

  const monthGroups = [];
  let currentGroupKey = null;
  let currentGroup = null;

  sortedFlights.forEach(flight => {
    const date = new Date(flight.flt_date);
    const monthKey = `${date.getFullYear()}-${date.getMonth().toString().padStart(2, '0')}`;

    if (!currentGroup || currentGroupKey !== monthKey) {
      currentGroupKey = monthKey;
      currentGroup = {
        label: date.toLocaleDateString('en-US', {
          month: 'long',
          year: 'numeric'
        }),
        flights: []
      };
      monthGroups.push(currentGroup);
    }

    currentGroup.flights.push(flight);
  });

  monthGroups.forEach(group => {
    const monthRow = document.createElement('tr');
    monthRow.innerHTML = `
      <td colspan="8" class="month-separator">
        <div class="month-divider">
          <span class="month-label">${group.label}</span>
        </div>
      </td>
    `;
    tbody.appendChild(monthRow);

    const getCreatedTimestamp = flight => {
      const raw = flight.created_at || flight.inserted_at || flight.flt_created_at || flight.flt_updated_at || flight.flt_date;
      const timestamp = raw ? new Date(raw).getTime() : 0;
      return Number.isFinite(timestamp) ? timestamp : 0;
    };

    group.flights
      .slice()
      .sort((a, b) => getCreatedTimestamp(b) - getCreatedTimestamp(a))
      .forEach(flight => {
      const row = document.createElement('tr');

      const date = new Date(flight.flt_date);
      const formattedDate = date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });

      const route = `${flight.flt_dep} - ${flight.flt_arr}`;

      const formatTime = timeString => {
        if (!timeString) {
          return '00:00';
        }

        const [hours, minutes] = timeString.split(':');
        return `${hours}:${minutes}`;
      };

      row.innerHTML = `
        <td class="checkbox-col">
          <input type="checkbox" class="form-check-input">
        </td>
        <td>
          <div class="date-badge">${formattedDate}</div>
        </td>
        <td>
          <div class="flight-number clickable-flight-number" data-flight-number="${flight.flt_number}" style="cursor: pointer; color: hsl(210, 76%, 36%);">${flight.flt_number}</div>
        </td>
        <td>
          <div class="route-info">
            <div class="route-main">${route}</div>
          </div>
        </td>
        <td>
          <div class="time-info">
            <div class="time-main">${formatTime(flight.flt_time)}</div>
          </div>
        </td>
        <td>
          <div class="time-info">
            <div class="time-main">${formatTime(flight.flt_block)}</div>
          </div>
        </td>
        <td>
          <div class="comments-info">
            <div class="comments-main ${!flight.flt_comments ? 'comments-empty' : ''}">${flight.flt_comments || 'n/a'}</div>
          </div>
        </td>
        <td>
          <div class="action-buttons">
            <button class="btn-action" title="View Details" data-action="view" data-id="${flight.id}" data-flight-number="${flight.flt_number}" style="pointer-events: none; opacity: 0.5;">
              <i class="bi bi-eye"></i>
            </button>
            <% if (user && user.role === 'superadmin') { %>
            <button class="btn-action" title="Edit" data-action="edit" data-id="${flight.id}">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn-action" title="Delete" data-action="delete" data-id="${flight.id}">
              <i class="bi bi-trash"></i>
            </button>
            <% } else { %>
            <span class="text-muted" style="font-size: 0.75rem;">Read Only</span>
            <% } %>
          </div>
        </td>
      `;

      // Make flight number clickable
      const flightNumberElement = row.querySelector('.clickable-flight-number');
      if (flightNumberElement) {
        flightNumberElement.addEventListener('click', function(e) {
          e.stopPropagation();
          const flightNumber = this.getAttribute('data-flight-number');
          viewFlight(flightNumber);
        });
      }

      const actionButtons = row.querySelectorAll('.btn-action');
      actionButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          e.stopPropagation();
          const action = this.getAttribute('data-action');
          const id = this.getAttribute('data-id');
          const flightNumber = this.getAttribute('data-flight-number');

          switch (action) {
            case 'view':
              // Disabled - use flight number click instead
              break;
            case 'edit':
              editFlight(id);
              break;
            case 'delete':
              deleteFlight(id);
              break;
          }
        });
      });

      tbody.appendChild(row);
      });
  });

  updateSortIcon();
}

function updateSortIcon() {
  const sortIcon = document.getElementById('dateSortIcon');

  if (!sortIcon) {
    return;
  }

  sortIcon.classList.remove('bi-chevron-up', 'bi-chevron-down');

  if (currentSortOrder === 'asc') {
    sortIcon.classList.add('bi-chevron-down');
  } else {
    sortIcon.classList.add('bi-chevron-up');
  }
}

// Action functions
function viewFlight(flightNumber) {
  // Encode flight number for URL (handle special characters)
  const encodedFlightNumber = encodeURIComponent(flightNumber);
  window.location.href = `/flights/${encodedFlightNumber}/expenses`;
}

function editFlight(id) {
  console.log('Edit flight:', id);
  // TODO: Implement edit functionality
}

async function deleteFlight(id) {
  // Show confirmation dialog
  const confirmed = confirm('Are you sure you want to delete this flight? This action cannot be undone.');
  
  if (!confirmed) {
    return;
  }
  
  try {
    const response = await apiRequest(`/api/flights/${id}`, {
      method: 'DELETE',
    });
    
    if (response.ok) {
      // Reload flights after successful deletion
      await loadFlights();
      console.log('Flight deleted successfully');
    } else {
      const errorData = await response.json();
      throw new Error(errorData.error || 'Failed to delete flight');
    }
  } catch (error) {
    console.error('Error deleting flight:', error);
    alert('Failed to delete flight: ' + error.message);
  }
}

// Load data when page loads
// Modal functions
function openAddFlightModal() {
  console.log('openAddFlightModal called');
  const modal = document.getElementById('addFlightModal');
  console.log('Modal element:', modal);
  
  if (modal) {
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
    console.log('Modal should be visible now');
    
    // Set today's date as default
    const today = new Date().toISOString().split('T')[0];
    const dateInput = document.getElementById('flightDate');
    if (dateInput) {
      dateInput.value = today;
    }
  } else {
    console.error('Modal element not found!');
  }
}

function closeAddFlightModal() {
  const modal = document.getElementById('addFlightModal');
  modal.classList.remove('show');
  document.body.style.overflow = 'auto';
  
  // Reset form
  document.getElementById('addFlightForm').reset();
}

// Time validation and formatting functions
function formatTimeInput(input) {
  let value = input.value.replace(/\D/g, ''); // Remove non-digits
  
  // Limit to 4 digits
  if (value.length > 4) {
    value = value.substring(0, 4);
  }
  
  input.value = value;
  
  // Auto-format to HH:MM when 4 digits are entered
  if (value.length === 4) {
    const hours = value.substring(0, 2);
    const minutes = value.substring(2, 4);
    
    // Validate hours (00-23)
    if (parseInt(hours) > 23) {
      input.setCustomValidity('Hours must be between 00 and 23');
      return false;
    }
    
    // Validate minutes (00-59)
    if (parseInt(minutes) > 59) {
      input.setCustomValidity('Minutes must be between 00 and 59');
      return false;
    }
    
    input.setCustomValidity(''); // Clear any previous validation errors
    return true;
  }
  
  input.setCustomValidity(''); // Clear validation errors
  return true;
}

function validateTimeInput(input) {
  const value = input.value;
  
  if (value.length === 4) {
    const hours = parseInt(value.substring(0, 2));
    const minutes = parseInt(value.substring(2, 4));
    
    if (hours > 23) {
      input.setCustomValidity('Hours must be between 00 and 23');
      return false;
    }
    
    if (minutes > 59) {
      input.setCustomValidity('Minutes must be between 00 and 59');
      return false;
    }
  }
  
  input.setCustomValidity('');
  return true;
}

document.addEventListener('DOMContentLoaded', function() {
  // Load statistics
  loadStats();
  // Load flights data
  loadFlights();
  
  // Test if modal functions are available
  console.log('DOM loaded, testing modal functions...');
  console.log('openAddFlightModal function:', typeof openAddFlightModal);
  console.log('closeAddFlightModal function:', typeof closeAddFlightModal);
  
  // Add event listeners for modal buttons
  const addFlightBtn = document.getElementById('addFlightBtn');
  if (addFlightBtn) {
    addFlightBtn.addEventListener('click', openAddFlightModal);
    console.log('Add Flight button event listener added');
  }
  
  const dateSortHeader = document.getElementById('dateSortHeader');
  if (dateSortHeader) {
    dateSortHeader.addEventListener('click', () => {
      currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
      renderFlights();
    });
  }
  
  const closeModalBtn = document.getElementById('closeModalBtn');
  if (closeModalBtn) {
    closeModalBtn.addEventListener('click', closeAddFlightModal);
    console.log('Close Modal button event listener added');
  }
  
  const cancelBtn = document.getElementById('cancelBtn');
  if (cancelBtn) {
    cancelBtn.addEventListener('click', closeAddFlightModal);
    console.log('Cancel button event listener added');
  }
  
  // Handle form submission
  const addFlightForm = document.getElementById('addFlightForm');
  if (addFlightForm) {
    addFlightForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const saveBtn = document.getElementById('saveFlightBtn');
      const btnText = saveBtn.querySelector('.btn-text');
      const btnSpinner = saveBtn.querySelector('.btn-spinner');
      
      // Show spinner
      btnText.style.display = 'none';
      btnSpinner.style.display = 'inline-block';
      saveBtn.disabled = true;
      
      try {
        const formData = new FormData(this);
        const flightData = Object.fromEntries(formData.entries());
        
        // Convert 4-digit time format to HH:MM:SS for database
        if (flightData.flt_time && flightData.flt_time.length === 4) {
          const hours = flightData.flt_time.substring(0, 2);
          const minutes = flightData.flt_time.substring(2, 4);
          flightData.flt_time = `${hours}:${minutes}:00`;
        }
        
        if (flightData.flt_block && flightData.flt_block.length === 4) {
          const hours = flightData.flt_block.substring(0, 2);
          const minutes = flightData.flt_block.substring(2, 4);
          flightData.flt_block = `${hours}:${minutes}:00`;
        }
        
        const response = await apiRequest('/api/flights', {
          method: 'POST',
          body: JSON.stringify(flightData)
        });
        
        if (response.ok) {
          // Close modal and reload flights
          closeAddFlightModal();
          await loadFlights();
          
          // Show success message (optional)
          console.log('Flight added successfully');
        } else {
          throw new Error('Failed to add flight');
        }
      } catch (error) {
        console.error('Error adding flight:', error);
        alert('Failed to add flight. Please try again.');
      } finally {
        // Hide spinner
        btnText.style.display = 'inline-block';
        btnSpinner.style.display = 'none';
        saveBtn.disabled = false;
      }
    });
  }
  
  // Close modal when clicking outside
  const addFlightModal = document.getElementById('addFlightModal');
  if (addFlightModal) {
    addFlightModal.addEventListener('click', function(e) {
      if (e.target === this) {
        closeAddFlightModal();
      }
    });
  }
  
  // Add time input validation and formatting
  const flightTimeInput = document.getElementById('flightTime');
  const blockTimeInput = document.getElementById('blockTime');
  
  if (flightTimeInput) {
    flightTimeInput.addEventListener('input', function() {
      formatTimeInput(this);
    });
    
    flightTimeInput.addEventListener('blur', function() {
      validateTimeInput(this);
    });
    
    // Prevent non-numeric input
    flightTimeInput.addEventListener('keypress', function(e) {
      if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'Enter'].includes(e.key)) {
        e.preventDefault();
      }
    });
  }
  
  if (blockTimeInput) {
    blockTimeInput.addEventListener('input', function() {
      formatTimeInput(this);
    });
    
    blockTimeInput.addEventListener('blur', function() {
      validateTimeInput(this);
    });
    
    // Prevent non-numeric input
    blockTimeInput.addEventListener('keypress', function(e) {
      if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'Enter'].includes(e.key)) {
        e.preventDefault();
      }
    });
  }
});
</script>

<style>
/* Modal styles */
.modal-overlay {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  background-color: rgba(0, 0, 0, 0.5) !important;
  display: none !important;
  justify-content: center !important;
  align-items: center !important;
  z-index: 10000 !important;
}

.modal-overlay.show {
  display: flex !important;
}

.modal-container {
  background: white !important;
  border-radius: 0.75rem !important;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
  width: 90% !important;
  max-width: 500px !important;
  overflow-y: visible !important;
  display: flex !important;
  flex-direction: column !important;
  max-height: 95vh !important;
}

.modal-header {
  display: flex !important;
  justify-content: space-between !important;
  align-items: center !important;
  padding: 1rem 1.5rem 0 1.5rem !important;
  border-bottom: 1px solid hsl(210, 11%, 90%) !important;
  margin-bottom: 1rem !important;
}

.modal-header h3 {
  margin: 0 !important;
  font-size: 1.25rem !important;
  font-weight: 600 !important;
  color: hsl(210, 6%, 21%) !important;
}

.modal-close {
  background: none !important;
  border: none !important;
  font-size: 1.25rem !important;
  color: hsl(210, 6%, 46%) !important;
  cursor: pointer !important;
  padding: 0.25rem !important;
  border-radius: 0.25rem !important;
  transition: all 0.2s ease !important;
}

.modal-close:hover {
  background-color: hsl(210, 11%, 95%) !important;
  color: hsl(210, 6%, 21%) !important;
}

.modal-form {
  padding: 0 1.5rem 0.5rem 1.5rem !important;
  display: flex !important;
  flex-direction: column !important;
  flex: 1 !important;
  min-height: 0 !important;
  overflow: hidden !important;
}

.form-group {
  margin-bottom: 0.875rem !important;
}

.form-group label {
  display: block !important;
  margin-bottom: 0.375rem !important;
  font-weight: 500 !important;
  color: hsl(210, 6%, 21%) !important;
  font-size: 0.875rem !important;
}

.form-group input,
.form-group textarea {
  width: 100% !important;
  padding: 0.75rem !important;
  border: 1px solid hsl(210, 11%, 90%) !important;
  border-radius: 0.5rem !important;
  font-size: 0.875rem !important;
  transition: all 0.2s ease !important;
  background-color: white !important;
  font-family: inherit !important;
  box-sizing: border-box !important;
}

.form-group input:focus,
.form-group textarea:focus {
  outline: none !important;
  border-color: hsl(142, 76%, 36%) !important;
  box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1) !important;
}

.form-group textarea {
  resize: vertical !important;
  min-height: 80px !important;
}

.form-group input::placeholder,
.form-group textarea::placeholder {
  color: hsl(210, 6%, 60%) !important;
}

.form-help {
  display: block !important;
  margin-top: 0.25rem !important;
  font-size: 0.75rem !important;
  color: hsl(210, 6%, 60%) !important;
  font-style: italic !important;
}

.form-group input:invalid {
  border-color: hsl(0, 84%, 60%) !important;
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
}

.form-group input:valid {
  border-color: hsl(142, 76%, 36%) !important;
}

.modal-actions {
  display: flex !important;
  justify-content: flex-end !important;
  gap: 0.75rem !important;
  margin-top: 0 !important;
  padding: 1rem 1.5rem !important;
  border-top: 1px solid hsl(210, 11%, 90%) !important;
  flex-shrink: 0 !important;
}

.btn {
  padding: 0.75rem 1.5rem !important;
  border-radius: 0.5rem !important;
  font-weight: 500 !important;
  font-size: 0.875rem !important;
  border: none !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
  display: inline-flex !important;
  align-items: center !important;
  gap: 0.5rem !important;
}

.btn:disabled {
  opacity: 0.6 !important;
  cursor: not-allowed !important;
}

.btn-cancel {
  background-color: hsl(0, 84%, 60%) !important;
  color: white !important;
}

.btn-cancel:hover:not(:disabled) {
  background-color: hsl(0, 84%, 55%) !important;
}

.btn-save {
  background-color: hsl(142, 76%, 36%) !important;
  color: white !important;
}

.btn-save:hover:not(:disabled) {
  background-color: hsl(142, 76%, 32%) !important;
}

.btn-spinner {
  animation: spin 1s linear infinite !important;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Month separator styles */
.month-separator {
  background-color: transparent !important;
  border: none !important;
  padding: 0 !important;
  height: 1px !important;
}

.month-divider {
  position: relative !important;
  height: 1px !important;
  background-color: hsl(210, 11%, 85%) !important;
  margin: 1rem 0 !important;
  display: flex !important;
  align-items: center !important;
  justify-content: flex-start !important;
}

.month-label {
  background-color: white !important;
  color: hsl(210, 6%, 46%) !important;
  font-size: 0.75rem !important;
  font-weight: 500 !important;
  padding: 0.25rem 0.75rem !important;
  border-radius: 0.375rem !important;
  border: 1px solid hsl(210, 11%, 85%) !important;
  text-transform: uppercase !important;
  letter-spacing: 0.05em !important;
}

/* Responsive design */
@media (max-width: 640px) {
  .modal-container {
    width: 95% !important;
    margin: 1rem !important;
  }
  
  .modal-header {
    padding: 0.75rem 1rem 0 1rem !important;
    margin-bottom: 0.75rem !important;
  }
  
  .modal-form {
    padding: 0 1rem 0.5rem 1rem !important;
  }
  
  .modal-actions {
    flex-direction: column !important;
  }
  
  .btn {
    width: 100% !important;
    justify-content: center !important;
  }
}

/* Comments column styles */
.comments-info {
  display: flex !important;
  flex-direction: column !important;
}

.comments-main {
  font-weight: 500 !important;
  color: hsl(210, 6%, 21%) !important;
  margin-bottom: 0.125rem !important;
  word-wrap: break-word !important;
  max-width: 200px !important;
}

.comments-empty {
  font-weight: normal !important;
  color: hsl(210, 6%, 60%) !important;
}
</style>